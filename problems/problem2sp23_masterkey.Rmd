---
title: "Problem Section 2"
subtitle:  "The sample variance and chi square distribution"
graphics: yes
output: pdf_document
header-includes: 
- \usepackage{amssymb, amsmath, amsfonts}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(mosaic)
```


### Exercises 

1. Suppose $\mathbf{x} = \langle 3, 4,5, 8 \rangle$ and consider the basis defined by 

- $\mathbf{u}_1 = \frac{1}{\sqrt{4} } \langle 1,1,1,1, \rangle$

- $\mathbf{u}_2 = \frac{1}{\sqrt{2} } \langle 1, -1, 0, 0 \rangle$

- $\mathbf{u}_3 = \frac{1}{\sqrt{6}} \langle 1, 1, -2,  0 \rangle$

- $\mathbf{u}_4 = \frac{1}{\sqrt{12 }} \langle 1, 1,1, -3\rangle$


  a.  Determine (by hand and then verify using `project` in \textbf{mosaic}) the coordinates $P_i$ of $\mathbf{x}$ with respect to the basis vectors $\left\{\mathbf{u}_1, \mathbf{u}_2, \mathbf{u}_3, \mathbf{u}_4 \right\}$. 
  
 
  
  We have from chapter 22 that $P_i =  (\mathbf{x}\cdot\mathbf{u}_i)$. This is what is called the projection coefficient, in this case what this means is that if we wanted to project $\mathbf{x}$ onto $\mathbf{u}_i$ we would have the formula: $Proj(\mathbf{x} \rightarrow \mathbf{u}_i) = \frac{ (\mathbf{x}\cdot\mathbf{u}_i)}{||\mathbf{u}_i||}\mathbf{u}_i$, thus the projection coefficient would be $\frac{ (\mathbf{x}\cdot\mathbf{u}_i)}{||\mathbf{u}_i||} =  (\mathbf{x}\cdot\mathbf{u}_i)$ since $||\mathbf{u}_i|| = 1$ as $\mathbf{u}_i$ is a unit vector. 
 
  We can code this in R:
  
```{r}
x <- c(3,4,5,8)
u1 <- (1/sqrt(4))*c(1,1,1,1)
u2 <- (1/sqrt(2))*c(1,-1,0,0)
u3 <- (1/sqrt(6))*c(1,1,-2,0)
u4 <- (1/sqrt(12))*c(1,1,1,-3)

p1 <- sum(x*u1)
p2 <- sum(x*u2)
p3 <- sum(x*u3)
p4 <- sum(x*u4)

tibble(u = c("u1","u2","u3","u4"),
       P_i = c(p1,p2,p3,p4))
```

We may also verify this with project:

```{r}
library(mosaic)
project(x,u1,type="coef")
project(x,u2,type="coef")
project(x,u3,type="coef")
project(x,u4,type="coef")
```

  
  b. Verify that $$\mathbf{x} = \sum\limits_{i=1}^{4} P_i \mathbf{u}_i.$$ 
  
```{r}
p1*u1 + p2*u2 + p3*u3 + p4*u4
x
```

  c.  Calculate the sample variance $s^2$ using R for this dataset. Then verify that $3\:s^2= P^2_2 + P^2_3 + P^2_4$.
  
```{r}
var(x)
```

```{r}
(p2^2+p3^2+p4^2)/3
```

 
2. A stock analyst claims to have devised a mathematical technique for selecting high-quality mutual funds
and promises that a client’s portfolio will have higher average ten-year annualized returns and lower volatility; that
is, a smaller standard deviation. After ten years, one of the
analyst’s twenty-four-stock portfolios showed a standard deviation of 10.17%. The benchmarks for the type of funds
considered are a standard deviation
of 15.67%.

a. Let $\sigma_0$ be the standard deviation for a twenty-four stock portfolio selected by the analyst’s method. Calculate a 95% confidence interval for $\sigma_0$. 

Here we may define $X_i$ as the 10 year return on the i'th stock in the 24-stock portfolio. Thus we have the data $x_1,\dots, x_{24}$ which represents the 24 different stock's 10 year performance. 

We may use theorem 22.3 here, where $\alpha = .05$ and $n=24$ (n is the number of stocks).

We have the form of the 95% CI for $\sigma_0$ will have the form:

$$
\left[\sqrt{\frac{(n-1)S^2}{\chi^2_{\alpha/2,n-1}}},\sqrt{\frac{(n-1)S^2}{\chi^2_{1-\alpha/2,n-1}}}\right]
$$
We have in this case that $S = 10.17$. Plugging in our values we have the 95% CI for $\sigma_0$ as:

```{r}
s_2 <- 10.17^2
n <- 24
alpha <- .05

sqrt(c((n-1)*s_2/qchisq(alpha/2,df=n-1,lower.tail=F), 
       (n-1)*s_2/qchisq(1-alpha/2,df=n-1,lower.tail=F)))
```

b. Do you think the assumptions underlying the confidence interval from part a are valid? If not, which ones might be violated?

Here we have each $x_i$ is the 10-year annualized return. 

We can interpret this as each $x_i$ as the average returns over a 10 year period for the i'th stock. So normality is plausible because we have an average (since averages contain sums). 

However, it may not be reasonable to assume that each $x_i$ is independent, since these stock prices may be correlated, especially if they are from the same industry. 


3. If a 90\% confidence interval for $\sigma^2_0$ is reported to be $[51.47, 261.90]$, what is the value of the sample variance $s^2$? 

We have by Theorem 22.3 that a $100(1-\alpha)\%$ interval for $\sigma_0^2$ will take the form:

$$
\left [\frac{(n-1)S^2}{\chi^2_{\alpha/2,n-1}},\frac{(n-1)S^2}{\chi^2_{1-\alpha/2,n-1}}\right ]
$$

Thus for an interval of the form $[L,U]$ we will have that:

$$
L = \frac{(n-1)S^2}{\chi^2_{\alpha/2,n-1}} \ , \ U=\frac{(n-1)S^2}{\chi^2_{1-\alpha/2,n-1}}
$$
We see in this case we have two unknowns $n$ and $S^2$ and two equations. Isolating $S^2$ we have that:

$$
S^2 = \frac{(L)\chi^2_{\alpha/2,n-1} }{n-1} = \frac{(U)\chi^2_{1-\alpha/2,n-1} }{n-1} 
$$

We see for the right two equations, that we have a single unknown, n. Thus we may use uniroot to find the value of n that leads to this equality, and thus we can plug it in to solve for $S^2$. We have that n is:

```{r}
L <- 51.47
U <- 261.9
alpha <- .1
n_finder <- function(n){
  (L/(n-1))*qchisq(.95,df = n-1) - (U/(n-1))*qchisq(.05,df = n-1)
}

n <- ceiling(uniroot(n_finder,interval = c(2,100))$root)
n
```

Thus plugging this into our formula from above we have $S^2$ as:

```{r}
S_2 <- U*qchisq(.05,9)/(n-1)
S_2
```









