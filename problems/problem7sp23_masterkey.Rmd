---
title: "Problem Section 7"
subtitle:  "Prior and Posterior"
graphics: yes
output: pdf_document
header-includes: 
- \usepackage{amssymb, amsmath, amsfonts}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(fastR2)
library(LearnBayes)
library(leaflet)
```

### Exercises 

1. The R function `leaflet_map` from the \textbf{leaflet} package can be used to generate random locations on the globe and to use Google maps to show you where these locations are:
```{r eval=F}

set.seed(3535)

leaflet_map(position=rgeo(n=20),mark=TRUE)
```

Use this to gather a sample of size 20 and calculate the proportion of the sample that represents a location which is covered with water. (You may need to zoom in for locations that are near where land and water meet) 

Let's assume that $X$, the number out of the 20 randomly selected locations which are covered with water, is a binomial random variable with success probability $\pi$. 

a. Calculate the posterior distribution for the proportion of the earth that is covered with water. Use a uniform prior for $\pi$. Make a plot of the uniform prior and the resulting posterior distribution on the same graph.

We have that $X$, the number out of 20 locations that are in water is 15.

If we assume that $X$ is a binomial distribution we have our posterior as:

$$
P(\pi|x)\propto \pi^x(1-\pi)^{20-x}\times 1
$$

We see that the posterior will be a $Beta(x+1,20-x+1)$ distribution.

We can plot them as follows:

```{r}
ggplot()+
  stat_function(fun = dunif,
                args = list(min =0,
                            max=1))+
  stat_function(fun = dbeta,
                args = list(shape1 = 15+1,
                            shape2 = 20-15+1),color='red')+
  labs(title = "Prior (black) and Posterior (red) of Water Coverage Proportion",
        ylab  = "Density")
```


b. Now suppose a Bayesian wants to use a beta distribution which reflects the prior knowledge that a majority of the earth is covered with water. Specifically, they assume that the mean of the prior is 0.70 and the variance is 0.05.

   i. Keeping in mind that for a $Beta(\alpha, \beta)$ distribution, $$E\left[X \right] = \frac{ \alpha}{\alpha + \beta}$$
   and the variance is
   $$Var\left[ X \right] =  \left( \frac{ \alpha}{\alpha + \beta} \right) \times \left(\frac{\beta}{\alpha + \beta} \right) \times
   \frac{1}{\alpha+\beta+1}$$
 elicit the values for $\alpha$ and $\beta$. 

    (Hint: Write the variance in terms of the mean as much as possible. It will help to remember that $\frac{\beta}{\alpha+\beta} = 1 - \frac{\alpha}{\alpha+\beta}$)
    
    
For the mean we wish for:

$$
\frac{ \alpha}{\alpha + \beta} = .7 = \mu
$$

This gives us that:

$$
\alpha+\beta = \frac{\alpha}{.7}
$$

We can write the variance as follows:

$$
Var(X) = \mu(1-\mu)\frac{1}{\alpha+\beta+1} = .05 = .7(.3)\frac{1}{\alpha+\beta+1} =.05
$$
    
Subbing in what we saw for the mean this gives us:

$$
.7(.3)\frac{1}{\alpha/.7+1} = .05
$$
Now we may solve for $\alpha$.

$$
\frac{.05}{.7}\alpha + .05 = .21 \rightarrow \alpha = .16\frac{.7}{.05} = 2.24
$$

Now using our equation for the mean where we know that:

$$
\alpha+\beta = \frac{\alpha}{.7} \rightarrow 2.24+\beta = \frac{2.24}{.7} \rightarrow \beta = .96
$$
So we will have a prior $Beta(2.24,.96)$

We can check this works via simulation as well:


```{r}
mean(rbeta(100000,2.24,.96))
var(rbeta(100000,2.24,.96))
```


   ii. Now calculate the posterior distribution using this informative prior from part i. 


We have the posterior will have the form:

$$
P(\pi|x) \propto \pi^x(1-\pi)^{20-x}\pi^{2.24-1}(1-\pi)^{.96-1} = \pi^{x+2.24-1}(1-\pi)^{20-x+.96-1}
$$

This will give us a posterior distribution of $Beta(x+2.24,20-x+.96)$.



   iii. Make a plot of your prior and the resulting posterior distribution in one graph.

Plotting this we have:

```{r}
ggplot()+
  stat_function(fun = dbeta,
                args = list(shape1 =2.24,
                            shape2=.96))+
  stat_function(fun = dbeta,
                args = list(shape1 = 15+2.24,
                            shape2 = 20-15+.96),color='red')+
  labs(title = "Prior (black) and Posterior (red) of Water Coverage Proportion",
        ylab  = "Density")
```
c. Now suppose you consider a prior with a median of 0.7 and 95\% of the distribution lies above 0.68. Use the `beta.select` function from the **LearnBayes** package to find the values of $\alpha$ and $\beta$ corresponding to these prior beliefs. Then repeat parts ii and iii from part b with this prior.

```{r}
library(LearnBayes)
```


```{r}
#median
quantile1 <- list(p = .5, x = .7)
#5th percentile
quantile2 <- list(p=.05, x=.68)
params <- beta.select(quantile1,quantile2)
params
```
Using the same formula as (ii) we have the posterior will take the form of a $Beta(x+1019.9,20-x+437.29)$ distribution. 

Now we may plot it:

```{r}
n <- 20
x <- 15
ggplot()+
  stat_function(fun = dbeta,
                args = list(shape1 =params[1],
                            shape2=params[2]))+
  stat_function(fun = dbeta,
                args = list(shape1 = x+params[1],
                            shape2 = n-x+params[2]),color='red')+
  labs(title = "Prior (black) and Posterior (red) of Water Coverage Proportion",
       ylab  = "Density")
```










